(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-31ad939d"],{"3f3e":function(t,e,i){"use strict";var o=i("f166"),s=i.n(o);s.a},ed41:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"body"},[i("div",{staticClass:"map"},[i("map-range",{on:{change:t.search}})],1),t._m(0),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowTips,expression:"isShowTips"}],staticClass:"tips"},[t._v("正在下载，请耐心等待。。。(可打开控制台查看进度详情)")])])},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"echarts"},[i("div",{attrs:{id:"map"}})])}],a=i("f499"),c=i.n(a),n=(i("7f7f"),i("386d"),i("7c39")),r=i.n(n),l=i("e724"),d=i("fb35"),h=i("0de6"),p={name:"demo",components:{MoneyDialog:h["a"],MapRange:d["a"]},data:function(){return{cityName:"中国",areaCode:1e4,geoJsonData:"",echartsMap:null,map:null,uimap:null,district:null,polygons:[],cityCode:1e5,citySelect:null,districtSelect:null,opts:{},areaData:{},mapData:[],zip:{},codeList:[],isCodeListLoadComplete:!1,downloadTips:"下载geoJson数据",isShowTips:!1}},mounted:function(){var t=this;this.zip=new r.a,this.citySelect=document.getElementById("city"),this.districtSelect=document.getElementById("district"),this.echartsMap=this.$echarts.init(document.getElementById("map")),this.echartsMap.on("click",this.echartsMapClick),this.map=new AMap.Map("container",{resizeEnable:!0,center:[116.30946,39.937629],zoom:3}),this.opts={subdistrict:1,showbiz:!1},this.district=new AMap.DistrictSearch(this.opts),this.district.search("中国",function(e,i){"complete"==e&&t.getData(i.districtList[0],"",1e5)})},watch:{isCodeListLoadComplete:function(t){t&&this.loadAllGeoJson()}},methods:{echartsMapClick:function(t){var e=this;if(console.log(t),this.$ba.trackEvent("echartsMap","点击地图","".concat(t.data.name,"-").concat(t.data.cityCode)),"street"!=t.data.level){for(var i=0,o=this.polygons.length;i<o;i++)this.polygons[i].setMap(null);this.cityName=t.data.name,this.cityCode=t.data.cityCode,this.district.setLevel(t.data.level),this.district.setExtensions("all"),this.district.search(this.cityCode,function(i,o){"complete"===i&&e.getData(o.districtList[0],t.data.level,e.cityCode)})}},loadMapData:function(t){var e=this;AMapUI.loadUI(["geo/DistrictExplorer"],function(i){var o=window.districtExplorer=new i({eventSupport:!0,map:e.map});o.loadAreaNode(t,function(t,i){if(t)console.error(t);else{var o={};o.features=i.getSubFeatures(),console.log(333,e.cityName,o),e.loadMap(e.cityName,o),e.geoJsonData=o}})})},showTips:function(){var t=this;this.isShowTips=!0,setTimeout(function(){t.isShowTips=!1},3e3)},downloadJson:function(t){if("all"===t)return this.$ba.trackEvent("echartsMap","文件下载","打包下载全部"),void this.$refs.dialog.show();var e=new Blob([c()(this.geoJsonData)],{type:"text/plain;charset=utf-8"}),i=this.cityName;"code"===t&&(i=this.cityCode),this.$ba.trackEvent("echartsMap","文件下载",i),Object(l["a"])(e,"".concat(i,".geoJson"))},loopSearch:function(t){var e=this;setTimeout(function(){e.district.search(t,function(i,o){if("complete"==i)for(var s in console.log("".concat(t,"--获取成功")),o.districtList[0].districtList)e.codeList.push({name:o.districtList[0].districtList[s].name,code:o.districtList[0].districtList[s].adcode,level:o.districtList[0].districtList[s].level}),e.codeList.length>=428&&(console.log("code获取完成"),e.isCodeListLoadComplete=!0),o.districtList[0].districtList[s].adcode&&"city"!=o.districtList[0].districtList[s].level&&"district"!=o.districtList[0].districtList[s].level&&"street"!=o.districtList[0].districtList[s].level&&e.loopSearch(o.districtList[0].districtList[s].adcode);else console.log("".concat(t,"--第一次获取失败，正在尝试进行第二次获取")),e.district.search(t,function(i,o){if("complete"==i)for(var s in console.log("".concat(t,"--第二次获取成功")),o.districtList[0].districtList)e.codeList.push({name:o.districtList[0].districtList[s].name,code:o.districtList[0].districtList[s].adcode,level:o.districtList[0].districtList[s].level}),e.codeList.length>=428&&(console.log("code获取完成"),e.isCodeListLoadComplete=!0);else console.log("".concat(t,"--第二次获取失败，请联系email：t@tsy6.com"))})})},500)},loadAllGeoJson:function(){var t=this;console.log("开始加载geoJson数据"),AMapUI.loadUI(["geo/DistrictExplorer"],function(e){var i=window.districtExplorer=new e({eventSupport:!0,map:t.map}),o={},s=function(e){setTimeout(function(){i.loadAreaNode(t.codeList[e].code,function(i,s){if(i?(t.codeList[e].geo="error",console.log("".concat(t.codeList[e].name,"--").concat(t.codeList[e].code,"，geo 数据获取失败，高德地图的锅^_^"))):(o.features=s&&s.getSubFeatures()||"",t.codeList[e].geo=o,console.log("".concat(t.codeList[e].level,"--").concat(t.codeList[e].name,"--").concat(t.codeList[e].code,"，geo 数据获取成功，马上为你打包"))),"province"===t.codeList[e].level?t.zip.file("100000/".concat(t.codeList[e].code,".geoJson"),c()(o)):t.zip.file("100000/".concat(t.codeList[e].code.substring(0,2),"0000/").concat(t.codeList[e].code,".geoJson"),c()(o)),t.codeList.every(function(t){return t.geo})){console.log("ziped");var a="\r\n\n                                            项目源码github地址：https://github.com/TangSY/echarts-map-demo （欢迎star）\n                                            \r\n\n                                            个人空间：https://www.hxkj.vip （欢迎闲逛）\n                                            \r\n\n                                             Email：t@tsy6.com  （遇到问题可以反馈）\n                                         ";t.zip.file("readMe(sourceCode).txt",a),t.downloadTips="文件打包压缩中...",t.zip.generateAsync({type:"blob"}).then(function(e){Object(l["a"])(e,"geoJson数据包.zip"),t.downloadTips="下载geoJson数据",t.isCodeListLoadComplete=!1,t.$ba.trackEvent("echartsMap","文件下载","打包下载成功")})}})},100*e)};for(var a in t.codeList)s(a)})},loadMap:function(t,e){if(console.log(11111,t,e),e){this.$echarts.registerMap(t,e);var i={visualMap:{type:"piecewise",pieces:[{max:30,label:"安全",color:"#2c9a42"},{min:30,max:60,label:"警告",color:"#d08a00"},{min:60,label:"危险",color:"#c23c33"}],color:"#fff",textStyle:{color:"#fff"},visibility:"off"},series:[{name:"数据名称",type:"map",roam:!1,mapType:t,selectedMode:"single",showLegendSymbol:!1,visibility:"off",itemStyle:{normal:{color:"#ccc",areaColor:"#fff",borderColor:"#fff",borderWidth:.5,label:{show:!0,textStyle:{color:"rgb(249, 249, 249)"}}},emphasis:{areaColor:!1,borderColor:"#fff",areaStyle:{color:"#fff"},label:{show:!0,textStyle:{color:"rgb(249, 249, 249)"}}}},data:this.mapData}]};console.log(77777,this.mapData),this.echartsMap.setOption(i)}},getData:function(t,e,i){var o=t.boundaries;if(o){for(var s=0,a=o.length;s<a;s++){var c=new AMap.Polygon({map:this.map,strokeWeight:1,strokeColor:"#0091ea",fillColor:"#80d8ff",fillOpacity:.2,path:o[s]});this.polygons.push(c)}this.map.setFitView()}"province"===e?(this.citySelect.innerHTML="",this.districtSelect.innerHTML=""):"city"===e&&(this.districtSelect.innerHTML="");var n=t.districtList;if(n){var r=new Option("--请选择--"),l=n[0].level;if("street"===l){var d=this.geoJsonData.features,h={};for(var p in d)d[p].properties.name==this.cityName&&(h.features=[].concat(d[p]));return this.mapData=[],this.mapData.push({name:this.cityName,value:100*Math.random(),level:l}),console.log(222,this.cityName,h),this.loadMap(this.cityName,h),void(this.geoJsonData=h)}var f=document.querySelector("#"+l);f.add(r),this.mapData=[];for(s=0,a=n.length;s<a;s++){var m=n[s].name,u=n[s].adcode;this.mapData.push({name:m,value:100*Math.random(),cityCode:u,level:l});var v=n[s].level;r=new Option(m),r.setAttribute("value",v),r.center=n[s].center,r.adcode=n[s].adcode,f.add(r)}this.loadMapData(i),this.areaData[l]=f}},search:function(t){for(var e=this,i=this.areaData[t],o=0,s=this.polygons.length;o<s;o++)this.polygons[o].setMap(null);var a=i[i.options.selectedIndex],c=a.text,n=a.adcode;this.cityName=c,this.cityCode=n,this.$ba.trackEvent("echartsMap","筛选地图","".concat(this.cityName,"-").concat(this.cityCode)),this.district.setLevel(a.value),this.district.setExtensions("all"),this.district.search(n,function(t,o){"complete"===t&&e.getData(o.districtList[0],i.id,n)})}}},f=p,m=(i("3f3e"),i("2877")),u=Object(m["a"])(f,o,s,!1,null,"31a0177f",null);e["default"]=u.exports},f166:function(t,e,i){}}]);
//# sourceMappingURL=chunk-31ad939d.bbe28e38.js.map